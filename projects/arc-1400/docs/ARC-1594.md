# ARC-1594: Core Security Token Operations (Draft)

Status: Draft  
Category: Standard Track  
Created: 2025-09-03  
Part of: ARC-1400 Suite  
Depends On: Algorand ASA (ARC-20 conceptually)  
Author(s): <your-name / org>

## 1. Abstract

ARC-1594 specifies core issuance, redemption, and transfer validation semantics for security tokens on Algorand. It provides deterministic pre-transfer checks and standardized status / error codes enabling wallets, exchanges, and compliance services to integrate with regulated token flows.

## 2. Motivation

Security tokens require pre-trade eligibility checks (KYC/AML, jurisdiction, lock-up expirations) that are not expressible purely via permissionless transfers. ERC-1594 defines these on Ethereum; this ARC maps them to Algorand leveraging atomic transaction groups and AVM logic for predictable, low-latency enforcement.

## 3. Specification

### 3.1 Interfaces (ABI Recommendations)

- `Issue(to, amount, partition, data:byte[])` -> Emits issue event/log.
- `Redeem(from, amount, partition, data:byte[])`
- `ValidateTransfer(partition, from, to, amount, data:byte[])` -> returns `(code:uint64, reason:byte[])`

Where `partition` MAY be 0 to denote "default/unrestricted" if ARC-1410 is not implemented; otherwise partition MUST map to a defined partition key.

### 3.2 Validation Flow

A compliant transfer SHOULD be structured as a group:

1. App call: `ValidateTransfer` (from signer = token holder or approved operator) writes or logs approval tuple.
2. ASA transfer: executed only if validation passes.

Implementations MAY alternatively perform an inner transaction inside `TransferByPartition` (if combining with ARC-1410) to reduce group size.

### 3.3 Codes

Return codes:

- `0` Success
- `10` SenderNotEligible
- `11` RecipientNotEligible
- `12` PartitionRestricted
- `13` AmountExceedsPartitionBalance
- `14` GlobalTransferHalted
- `15` LockupActive
- `16` DocumentDisclosureRequired
- `20` UnknownPartition
- `30` InvalidSignatureOrAuth
- `40` InternalError

Codes MUST be logged as the first 8 bytes of a log entry or written to a well-known box/state key `last-val-code` keyed by sender address. Reason strings are optional and SHOULD be UTF-8.

### 3.4 State Model

Minimum required state keys / boxes:

- Global: `halt` (uint64; 1 = transfers disabled except controller)
- Local (per investor): `kyc` (uint64; 1 = eligible), `lockup-until` (uint64; round or timestamp), optional jurisdiction code `jur` (uint64)
- Boxes (optional extended): `elig-<addr>` for arbitrary packed compliance flags.

### 3.5 Authorization

Issuance / Redemption MUST be restricted to governance authority (Issuer) or delegated operators (multi-sig, logic signature) recorded in global state keys (`issuer`, `operator-<n>`). Validation is permissionless but enforces rules.

### 3.6 Events (Logging Conventions)

Implementations SHOULD log compact structured events (CBOR or msgpack) for indexing:

- Issue: tag 0x01 | addr | amount | partition
- Redeem: tag 0x02 | addr | amount | partition
- Validate: tag 0x03 | from | to | amount | partition | code

### 3.7 Failure Semantics

If validation fails, the subsequent ASA transfer MUST fail or be omitted. No partial state changes should misrepresent balances.

## 4. Security Considerations

- Ensure replay protection: include group ID or txn ID in validation ephemeral state so old approvals can't be reused.
- Prevent redemption of locked or escrowed partitions unless explicitly allowed.
- Use constant-time comparisons for signature attestations if verifying off-chain oracle attestations.

## 5. Reference Types

Suggested canonical encoding for address lists in boxes: msgpack array of raw 32-byte addresses.

## 6. Compliance Oracle Pattern (Optional)

An oracle signs `(from, to, amount, partition, round, expiryRound)`; contract verifies signature against authorized oracle key, bypassing on-chain local flags where policy allows.

## 7. Backwards Compatibility

Can coexist with a plain ASA; if wallet ignores validation flow, clawback + compliance enforcement can still reverse unauthorized transfers (with ARC-1644) though this is discouraged for UX predictability.

## 8. Reference Implementation

To be provided in `/smart_contracts/security_token`.

## 9. Copyright

CC0 1.0 Universal.
