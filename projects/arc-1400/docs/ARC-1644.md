# ARC-1644: Controller Operations for Security Tokens (Draft)

Status: Draft  
Category: Standard Track  
Created: 2025-09-03  
Part of: ARC-1400 Suite  
Depends On: ARC-1594, ARC-1410  
Author(s): Ludovit Scholtz

## 1. Abstract

ARC-1644 defines standardized controller powers for security tokens on Algorand, enabling forced transfers and redemptions under strictly governed conditions (e.g., court order, regulatory action, error remediation). It mirrors Ethereum's ERC-1644 while adapting privilege enforcement to Algorand's ARC-200 token control and smart contract mechanism.

## 2. Motivation

Certain regulated events necessitate administrative intervention. A predictable, auditable interface reduces systemic risk and ensures interoperability across custodians and secondary trading platforms.

## 3. Specification

### 3.1 Controller Authorization

Global state MUST store `controller` (address) OR a list of controllers in a box `controllers`. A multi-sig or logic signature is RECOMMENDED. Changes to controller set SHOULD be timelocked via `pending-controller` + `activate-round` pattern.

### 3.2 Required Methods (snake_case, ARC-4 types)

Canonical ERC-1644 defines 3 functions: `controllerTransfer`, `controllerRedeem`, `isControllable`. Base ARC-1644 mirrors that minimal surface; controller management is an extension (see 3.4).

All base methods are namespaced with `arc1644_`.

- `arc1644_controller_transfer(from: address, to: address, amount: uint64, data: bytes, operator_data: bytes) -> (code: uint64)`
  - Forces a transfer of `amount` from `from` to `to`.
  - MUST return a status / reason code consistent with ARC-1594.
- `arc1644_controller_redeem(from: address, amount: uint64, operator_data: bytes) -> (code: uint64)`
  - Forces redemption (burn) from `from`.
- `arc1644_is_controllable() -> (flag: uint64)`
  - Returns 1 iff controller operations are currently enabled.

Partition awareness is intentionally NOT in the base interface (matches ERC-1644). A Partition Controller Extension is defined in section 3.5.

### 3.3 Semantics (Base)

Controller operations bypass standard sender consent but MUST still respect partition invariants and reason codes. Forced actions SHOULD emit logs referencing `operator_data` justification.

### 3.4 Controller Governance Extension (Optional)

If an implementation wishes to expose on-chain controller set governance, it MAY add:

- `arc1644_set_controller(new_controller: address)` (timelocked commit pattern RECOMMENDED)
- Or multi-controller form:
  - `arc1644_add_controller(addr: address)`
  - `arc1644_remove_controller(addr: address)`

Timelock pattern: store `pending_controller`, `pending_set_round`, enforce activation after `pending_set_round + min_delay`.

Disabling control: A governance call MAY irreversibly set `controllable = 0` and zero out controller address(es); afterwards `arc1644_is_controllable` MUST return 0 permanently.

### 3.5 Partition Controller Extension (Optional)

For tokens implementing ARC-1410 partitions, the following extension functions MAY be added (mirroring ARC-1410 semantics):

- `arc1644_controller_transfer_partition(from: address, to: address, partition: bytes32, amount: uint64, data: bytes, operator_data: bytes) -> (code: uint64)`
- `arc1644_controller_redeem_partition(from: address, partition: bytes32, amount: uint64, operator_data: bytes) -> (code: uint64)`

Reason code mapping MUST remain consistent with ARC-1594; partition not found or insufficient balance codes SHOULD reuse existing insufficiency codes.

If extension is absent, attempts to call these methods MUST reject.

### 3.6 Semantics (Partition Extension)

Controller partition operations bypass holder consent but MUST maintain partition accounting invariants identical to standard partition transfers/redemptions.

### 3.7 Execution Pattern

Implementation configures ARC-200 transfer authority such that only application-governed logic can perform forced movements (e.g., via a logic-controlled clawback equivalent or authority address). `arc1644_controller_transfer` constructs an inner ARC-200 transfer `from -> to`. If using an external authority address, ensure it is rekeyed / restricted to contract governance.

### 3.8 Events (Logs)

Base (no partition):

- Tag 0x31 arc1644_controller_transfer | controller | from | to | amount | code
- Tag 0x32 arc1644_controller_redeem | controller | from | amount | code
- Tag 0x33 arc1644_controller_changed | old | new

Partition Extension (if implemented):

- Tag 0x34 arc1644_controller_transfer_partition | controller | from | to | partition | amount | code
- Tag 0x35 arc1644_controller_redeem_partition | controller | from | partition | amount | code

### 3.9 Reason Codes

Implementations MUST reuse ARC-1594 codes. Recommended additional (extension) codes if not already allocated:

- `50` ControllerUnauthorized (caller not an authorized controller)
- `51` ControllerDisabled (controllable flag off)
- `52` JustificationRequired (non-empty operator_data required)

These codes SHOULD NOT collide with existing ARC-1594 numeric assignments; if conflicts arise, implementers MAY shift into an unused high range (e.g., >= 200) but MUST document mapping.

### 3.10 Safeguards

- Mandatory justification: if global `require-just` == 1, `operator_data` MUST contain a non-empty explanation or legal reference identifier.
- Rate limiting (optional): store last controller action round; enforce minimum interval.
- Audit trail: append structured log with reason code + hashed justification docs.

### 3.11 Disabling Control

`arc1644_is_controllable` may return 0 after a governance decision to renounce override powers. Implementation sets `controller` to zero-address and `controllable` = 0 (immutable).

## 4. Security Considerations

- Ensure controller cannot mint (that's issuance) unless explicitly allowed; separation of duties.
- Timelock controller changes to mitigate key compromise.
- Make justification transparent while avoiding sensitive full-text storage (hash large documents).

## 5. Backwards Compatibility

If not implemented, `arc1644_is_controllable` MUST return 0 and controller methods MUST revert / reject with `51`.

## 6. Reference Implementation

Base + governance + partition extension planned in `smart_contracts/security_token` as `Arc1644` (TBD). Partition functions ONLY present if ARC-1410 also enabled.

## 7. Copyright

CC0 1.0 Universal.
